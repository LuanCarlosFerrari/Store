<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Controle de Estoque e Vendas - Loja</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#000000',
                        'secondary': '#404040',
                        'accent': '#666666',
                        'background': '#f5f5f5'
                    },
                    animation: {
                        'spin-slow': 'spin 2s linear infinite',
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideIn: {
                            '0%': { opacity: '0', transform: 'translateX(-10px)' },
                            '100%': { opacity: '1', transform: 'translateX(0)' }
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="font-sans bg-gray-50 text-gray-900">

    <!-- Topbar -->
    <header
        class="fixed top-0 left-0 w-full h-16 bg-black text-white flex items-center justify-between px-4 sm:px-6 shadow-md z-50">
        <h1 class="text-base sm:text-xl font-semibold">Sistema de Estoque</h1>
        <div class="flex items-center space-x-2 sm:space-x-4">
            <span id="userEmail" class="text-xs sm:text-sm text-gray-300"></span>
            <button id="logoutBtn"
                class="bg-gray-700 px-2 py-1 rounded hover:bg-gray-600 text-xs sm:text-sm">Sair</button>
        </div>
    </header>

    <!-- Sidebar (responsiva) -->
    <aside
        class="fixed top-16 left-0 w-full sm:w-64 h-12 sm:h-[calc(100vh-4rem)] bg-gray-900 text-white flex sm:flex-col sm:space-y-2 justify-center sm:justify-start gap-1 sm:gap-0 px-2 sm:px-3 items-center sm:items-start overflow-x-auto sm:overflow-visible">
        <a href="#" onclick="mostrarAba('dashboard')"
            class="hover:bg-gray-700 px-3 py-2 rounded text-sm sm:w-full text-center sm:text-left whitespace-nowrap">Dashboard</a>
        <a href="#" onclick="mostrarAba('produtos')"
            class="hover:bg-gray-700 px-3 py-2 rounded text-sm sm:w-full text-center sm:text-left whitespace-nowrap">Estoque</a>
        <a href="#" onclick="mostrarAba('clientes')"
            class="hover:bg-gray-700 px-3 py-2 rounded text-sm sm:w-full text-center sm:text-left whitespace-nowrap">Clientes</a>
        <a href="#" onclick="mostrarAba('caixa')"
            class="hover:bg-gray-700 px-3 py-2 rounded text-sm sm:w-full text-center sm:text-left whitespace-nowrap">Caixa</a>
        <a href="#" onclick="mostrarAba('pagamentos')"
            class="hover:bg-gray-700 px-3 py-2 rounded text-sm sm:w-full text-center sm:text-left whitespace-nowrap">Pagamentos</a>
    </aside>

    <!-- Conteúdo Principal -->
    <main class="sm:ml-64 mt-28 sm:mt-16 px-4 sm:px-6">

        <!-- Dashboard -->
        <div id="dashboard" class="aba">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-2">
                <h2 class="text-xl sm:text-2xl font-bold text-black">Dashboard</h2>
                <div class="flex flex-wrap items-center gap-2">
                    <label for="dataSelecionada" class="text-sm font-medium text-gray-700">Data:</label>
                    <input type="date" id="dataSelecionada"
                        class="border border-gray-400 rounded-md px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-black">
                    <button onclick="resetarFiltroData()"
                        class="bg-gray-500 text-white px-2 py-1 rounded text-sm hover:bg-gray-600">Limpar</button>
                    <div id="dashboard-loading" class="hidden">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-black"></div>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-white shadow-md rounded p-4">
                    <h3 class="text-lg font-semibold text-secondary">Produtos em Estoque</h3>
                    <p class="text-2xl font-bold mt-2" id="total-produtos">0</p>
                </div>
                <div class="bg-white shadow-md rounded p-4">
                    <h3 class="text-lg font-semibold text-secondary">Vendas da Data</h3>
                    <p class="text-2xl font-bold mt-2" id="vendas-dia">R$ 0,00</p>
                    <p class="text-xs text-gray-500 mt-1" id="data-selecionada-display">Hoje</p>
                </div>
                <div class="bg-white shadow-md rounded p-4">
                    <h3 class="text-lg font-semibold text-secondary">Clientes Cadastrados</h3>
                    <p class="text-2xl font-bold mt-2" id="total-clientes">0</p>
                </div>
            </div>
            <div class="bg-white shadow-md rounded p-4 overflow-x-auto">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-black text-white">
                        <tr>
                            <th class="border-b py-2 px-2">Data</th>
                            <th class="border-b py-2 px-2">Cliente</th>
                            <th class="border-b py-2 px-2">Produto</th>
                            <th class="border-b py-2 px-2">Qtd</th>
                            <th class="border-b py-2 px-2">Total</th>
                        </tr>
                    </thead>
                    <tbody id="dashboard-vendas">
                        <tr>
                            <td colspan="5" class="py-4 px-2 text-center text-gray-500">Nenhuma venda registrada</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Produtos -->
        <div id="produtos" class="aba hidden">
            <h2 class="text-xl sm:text-2xl font-bold mb-4">Gerenciar Estoque</h2>
            <div class="bg-white shadow-md rounded p-4 space-y-4">
                <form class="space-y-3">
                    <input type="text" placeholder="Nome do Produto"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm">
                    <input type="number" placeholder="Quantidade"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm">
                    <input type="number" step="0.01" placeholder="Preço (R$)"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm">
                    <button type="submit"
                        class="px-4 py-2 bg-black text-white rounded-md hover:bg-gray-800 text-sm">Adicionar
                        Produto</button>
                </form>
                <ul class="list-disc pl-5 space-y-2 text-gray-900">
                    <li>Exemplo Produto 1 - 10 unidades - R$ 15,00</li>
                    <li>Exemplo Produto 2 - 5 unidades - R$ 8,50</li>
                </ul>
            </div>
        </div>

        <!-- Clientes -->
        <div id="clientes" class="aba hidden">
            <h2 class="text-xl sm:text-2xl font-bold mb-4">Gerenciar Clientes</h2>
            <div class="bg-white shadow-md rounded p-4 space-y-4">
                <form class="space-y-3">
                    <input type="text" placeholder="Nome do Cliente"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm">
                    <input type="text" placeholder="Telefone"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm">
                    <button type="submit"
                        class="px-4 py-2 bg-black text-white rounded-md hover:bg-gray-800 text-sm">Adicionar
                        Cliente</button>
                </form>
                <ul class="list-disc pl-5 space-y-2 text-gray-900">
                    <li>Exemplo Cliente 1 - (11) 99999-9999</li>
                    <li>Exemplo Cliente 2 - (21) 98888-8888</li>
                </ul>
            </div>
        </div>

        <!-- Caixa -->
        <div id="caixa" class="aba hidden">
            <h2 class="text-xl sm:text-2xl font-bold mb-4">Sistema de Vendas e Pagamentos</h2>
            <div class="bg-white shadow-md rounded p-4 space-y-4">
                <form class="space-y-3">
                    <select id="selectCliente" class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm">
                        <option value="">Selecione um cliente</option>
                    </select>
                    <select id="selectProduto" class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm">
                        <option value="">Selecione um produto</option>
                    </select>
                    <input id="inputQuantidade" type="number" placeholder="Quantidade"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm" min="1">
                    <input id="inputValorTotal" type="number" step="0.01" placeholder="Valor Total (R$)"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm" readonly>
                    <button type="submit"
                        class="px-4 py-2 bg-black text-white rounded-md hover:bg-gray-800 text-sm">Registrar
                        Venda</button>
                </form>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-left border-collapse">
                        <thead class="bg-black text-white">
                            <tr>
                                <th class="border-b py-2 px-2">Data</th>
                                <th class="border-b py-2 px-2">Cliente</th>
                                <th class="border-b py-2 px-2">Produto</th>
                                <th class="border-b py-2 px-2">Qtd</th>
                                <th class="border-b py-2 px-2">Valor (R$)</th>
                                <th class="border-b py-2 px-2">Status Pagamento</th>
                            </tr>
                        </thead>
                        <tbody id="corpoTabelaVendas">
                            <tr class="hover:bg-gray-100">
                                <td class="py-2 px-2">20/06/2025</td>
                                <td class="py-2 px-2">Exemplo Cliente 1</td>
                                <td class="py-2 px-2">Exemplo Produto 1</td>
                                <td class="py-2 px-2">3</td>
                                <td class="py-2 px-2">45,00</td>
                                <td class="py-2 px-2 text-green-600">Pago</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Pagamentos -->
        <div id="pagamentos" class="aba hidden">
            <h2 class="text-xl sm:text-2xl font-bold mb-4">Gerenciamento de Pagamentos</h2>

            <!-- Filtros -->
            <div class="bg-white shadow-md rounded p-4 mb-4">
                <h3 class="text-lg font-semibold mb-3">Filtros</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <select id="filtroStatusPagamento" class="border border-gray-400 rounded-md px-3 py-2 text-sm">
                        <option value="">Todos os Status</option>
                        <option value="pendente">Pendentes</option>
                        <option value="pago">Pagos</option>
                        <option value="parcial">Parcialmente Pagos</option>
                        <option value="vencido">Vencidos</option>
                        <option value="cancelado">Cancelados</option>
                    </select>

                    <select id="filtroMetodoPagamento" class="border border-gray-400 rounded-md px-3 py-2 text-sm">
                        <option value="">Todos os Métodos</option>
                        <option value="dinheiro">Dinheiro</option>
                        <option value="pix">PIX</option>
                        <option value="cartao_debito">Cartão de Débito</option>
                        <option value="cartao_credito">Cartão de Crédito</option>
                        <option value="transferencia">Transferência</option>
                        <option value="boleto">Boleto</option>
                    </select>

                    <input type="date" id="filtroDataInicio" class="border border-gray-400 rounded-md px-3 py-2 text-sm"
                        placeholder="Data Início">

                    <button onclick="aplicarFiltrosPagamentos()"
                        class="px-4 py-2 bg-black text-white rounded-md hover:bg-gray-800 text-sm">
                        Filtrar
                    </button>
                </div>
            </div>

            <!-- Resumo Financeiro -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <div class="bg-white p-4 rounded shadow">
                    <h3 class="text-sm font-medium text-gray-600">Total a Receber</h3>
                    <p id="totalReceber" class="text-2xl font-bold text-blue-600">R$ 0,00</p>
                </div>
                <div class="bg-white p-4 rounded shadow">
                    <h3 class="text-sm font-medium text-gray-600">Total Recebido</h3>
                    <p id="totalRecebido" class="text-2xl font-bold text-green-600">R$ 0,00</p>
                </div>
                <div class="bg-white p-4 rounded shadow">
                    <h3 class="text-sm font-medium text-gray-600">Em Atraso</h3>
                    <p id="totalAtraso" class="text-2xl font-bold text-red-600">R$ 0,00</p>
                </div>
                <div class="bg-white p-4 rounded shadow">
                    <h3 class="text-sm font-medium text-gray-600">Parcialmente Pago</h3>
                    <p id="totalParcial" class="text-2xl font-bold text-yellow-600">R$ 0,00</p>
                </div>
            </div>

            <!-- Lista de Pagamentos -->
            <div class="bg-white shadow-md rounded p-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Lista de Pagamentos</h3>
                    <button onclick="verificarPagamentosVencidos()"
                        class="px-3 py-1 bg-orange-500 text-white rounded text-sm hover:bg-orange-600">
                        Verificar Vencidos
                    </button>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full text-left border-collapse">
                        <thead class="bg-black text-white">
                            <tr>
                                <th class="border-b py-2 px-2">Data Venda</th>
                                <th class="border-b py-2 px-2">Cliente</th>
                                <th class="border-b py-2 px-2">Produto</th>
                                <th class="border-b py-2 px-2">Valor Total</th>
                                <th class="border-b py-2 px-2">Valor Pago</th>
                                <th class="border-b py-2 px-2">Vencimento</th>
                                <th class="border-b py-2 px-2">Status</th>
                                <th class="border-b py-2 px-2">Método</th>
                                <th class="border-b py-2 px-2">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="corpoTabelaPagamentos">
                            <tr>
                                <td colspan="9" class="border px-2 py-4 text-gray-500 text-center">
                                    Carregando pagamentos...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </main>

    <!-- Modal de Pagamento -->
    <div id="modalPagamento" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">Configurar Pagamento</h3>
                <button id="fecharModalPagamento" class="text-gray-500 hover:text-gray-700">
                    <span class="text-xl">&times;</span>
                </button>
            </div>

            <div class="mb-4">
                <p class="text-sm text-gray-600">Valor Total:</p>
                <p id="valorTotalModal" class="text-xl font-bold text-green-600">R$ 0,00</p>
            </div>

            <form id="formPagamento" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Venda</label>
                    <select id="tipoVenda" class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm">
                        <option value="a_vista">À Vista</option>
                        <option value="a_prazo">À Prazo</option>
                        <option value="parcelada">Parcelada</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Método de Pagamento</label>
                    <select id="metodoPagamento" class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm">
                        <option value="dinheiro">Dinheiro</option>
                        <option value="pix">PIX</option>
                        <option value="cartao_debito">Cartão de Débito</option>
                        <option value="cartao_credito">Cartão de Crédito</option>
                        <option value="transferencia">Transferência Bancária</option>
                        <option value="boleto">Boleto</option>
                    </select>
                </div>

                <div id="divVencimento" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Dias para Vencimento</label>
                    <input id="diasVencimento" type="number" min="1" value="30"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm">
                </div>

                <div id="divParcelas" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Número de Parcelas</label>
                    <input id="numeroParcelas" type="number" min="2" max="12" value="2"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Observações</label>
                    <textarea id="observacoesPagamento" rows="3"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 text-sm"
                        placeholder="Observações sobre o pagamento..."></textarea>
                </div>

                <div class="flex space-x-3 pt-4">
                    <button type="button" id="btnCancelarPagamento"
                        class="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 px-4 py-2 bg-black text-white rounded-md hover:bg-gray-800">
                        Confirmar Venda
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts modularizados -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/database.js"></script>
    <script src="js/produtos.js"></script>
    <script src="js/clientes.js"></script>
    <script src="js/pagamentos.js"></script>
    <script src="js/pagamentos-interface.js"></script>
    <script src="js/vendas.js"></script>
    <script src="js/app.js"></script>
    <script src="js/global-init.js"></script>

    <script>
        // Adicionar event listeners para o modal de pagamento
        document.addEventListener('DOMContentLoaded', function () {
            const tipoVenda = document.getElementById('tipoVenda');
            const divVencimento = document.getElementById('divVencimento');
            const divParcelas = document.getElementById('divParcelas');
            const btnCancelarPagamento = document.getElementById('btnCancelarPagamento');

            if (tipoVenda) {
                tipoVenda.addEventListener('change', function () {
                    const valor = this.value;

                    if (valor === 'a_vista') {
                        divVencimento.classList.add('hidden');
                        divParcelas.classList.add('hidden');
                    } else if (valor === 'a_prazo') {
                        divVencimento.classList.remove('hidden');
                        divParcelas.classList.add('hidden');
                    } else if (valor === 'parcelada') {
                        divVencimento.classList.remove('hidden');
                        divParcelas.classList.remove('hidden');
                    }
                });
            }

            if (btnCancelarPagamento) {
                btnCancelarPagamento.addEventListener('click', function () {
                    document.getElementById('modalPagamento').classList.add('hidden');
                });
            }
        });
    </script>
</body>

</html>